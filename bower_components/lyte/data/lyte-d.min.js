function ReplaceWith(e){var t=this.parentNode,r=arguments.length,o=+(t&&"object"==typeof e);if(t){for(;r-- >o;)t&&"object"!=typeof arguments[r]&&(arguments[r]=document.createTextNode(arguments[r])),t||!arguments[r].parentNode?t.insertBefore(this.previousSibling,arguments[r]):arguments[r].parentNode.removeChild(arguments[r]);o&&t.replaceChild(this,e)}}[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("after")||Object.defineProperty(e,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach(function(e){var r=e instanceof Node;t.appendChild(r?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(t,this.nextSibling)}})}),Element.prototype.replaceWith||(Element.prototype.replaceWith=ReplaceWith),CharacterData.prototype.replaceWith||(CharacterData.prototype.replaceWith=ReplaceWith),DocumentType.prototype.replaceWith||(DocumentType.prototype.replaceWith=ReplaceWith),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return t<this.length?t|=0:t=this.length,this.substr(t-e.length,e.length)===e}),Lyte={},Lyte.version=1,Lyte.registeredMixins={},Lyte.Mixin={},Lyte.debug=!1,Lyte.performance=!1,Lyte.toBeRegistered=[];var consoleTime=[];function domContentLoaded1(){let e=Lyte.toBeRegistered;if(e.length){for(let t=0;t<e.length;t++)customElements.define(e[t].name,e[t].def);Lyte.toBeRegistered=[]}}Lyte.Mixin.register=function(e,t){Lyte.registeredMixins[e]=t},Lyte.log=function(e,t){Lyte.debug&&console.log((t?"%c":"")+e,"color:"+t)},Lyte.time=function(e){var t;Lyte.performance&&(-1!=(t=consoleTime.indexOf(e))?(consoleTime.splice(t,1),console.timeEnd(e)):(consoleTime.push(e),console.time(e)))},Lyte.isRecord=function(e){return!!(e&&e.$&&e.$.hasOwnProperty("isModified"))},Lyte.isComponent=function(e){return!!(e&&e.$node&&e.__data)},Lyte.injectResources=function(e,t,r){if(e){var o=-(e=Array.isArray(e)?e:[e]).length;e.forEach(function(e){var n,i=e.split("."),a=i[i.length-1];n=document.createElement({js:"script",css:"link"}[a]),1!=i.length?("css"==a?(n.setAttribute("href",e),n.setAttribute("type","text/css"),n.setAttribute("rel","stylesheet")):n.setAttribute("src",e),n.onerror=n.onload=function(e){o++,t&&t.call(this,e),r&&0==o&&r()},document.head.appendChild(n)):console.error("Type of file is not specified in injectResources.")})}},Lyte.checkProperty=function(e,t,r,o,n){switch(e){case"type":if(Lyte.Transform.hasOwnProperty(o)){if(Array.isArray(t)){if("array"!=Lyte.Transform[o].extends)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(Lyte.Transform[o].extends!=typeof t)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(Array.isArray(t)){if("array"!=o)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(o!=typeof t)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o};break;case"maximum":if("number"==typeof t&&t>o)return{code:"ERR04",message:Lyte.errorCodes.ERR04,expected:o};break;case"minimum":if("number"==typeof t&&t<o)return{code:"ERR05",message:Lyte.errorCodes.ERR05,expected:o};break;case"maxLength":case"maxItems":if(t.length>o)return{code:"ERR06",message:Lyte.errorCodes.ERR06,expected:o};break;case"minLength":case"minItems":if(t.length<o)return{code:"ERR07",message:Lyte.errorCodes.ERR07,expected:o};break;case"pattern":if("string"==typeof t&&!new RegExp(o).test(t))return{code:"ERR08",message:Lyte.errorCodes.ERR08,expected:o};break;case"uniqueItems":if(Array.isArray(t)&&o)for(var i=[],a=0;a<t.length;a++){var s=t[a];if(-1!=i.indexOf(s))return{code:"ERR09",message:Lyte.errorCodes.ERR09};i.push(s)}break;case"constant":if(Array.isArray(t)){if(!(c=t.length==o.length&&t.every(function(e,t){return e===o[t]})))return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if("object"==typeof t){if(!(c=store.adapter.$.compareObjects(t,o)))return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if(t!=o)return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o};break;case"items":if(Array.isArray(t))for(a=0;a<t.length;a++)for(var e in o){if(1!=(c=Lyte.checkProperty(e,t[a],a,o[e])))return c}break;case"properties":if("object"==typeof t&&!Array.isArray(t))for(var r in t)for(var e in o){if(1!=(c=Lyte.checkProperty(e,t[r],r,o[e])))return c}break;case"validation":var c;if(1!=(c=Lyte.customValidator[o].apply(n,[r,t])))return c}return!0},Lyte.types=["string","object","number","boolean","array"],Lyte.attr=function(e,t){if(void 0==t&&(t={}),-1==this.types.indexOf(e)&&!Lyte.Transform.hasOwnProperty(e))throw new Error("Not a valid field type - "+e);return t.type=e,t},Lyte.defineRelation=function(e,t,r){var o={type:"relation",relType:t,relatedTo:e};return r&&(o.opts=r),o},Lyte.belongsTo=function(e,t){return this.defineRelation(e,"belongsTo",t)},Lyte.hasMany=function(e,t){return this.defineRelation(e,"hasMany",t)},Lyte.Transform={},Lyte.customValidator={},Lyte.registerDataType=function(e,t){if(this.Transform.hasOwnProperty(e))throw new Error("Custom Field Type - "+e+" -  already exists.");if(void 0==t.extends||-1==Lyte.types.indexOf(t.extends))throw new Error("Not a valid field type - "+t.extends);this.Transform[e]=t},Lyte.registerValidator=function(e,t){if(this.customValidator.hasOwnProperty(e))throw new Error("Custom Validator with name - "+e+" - already exists");this.customValidator[e]=t},Lyte.patterns={email:/([A-Za-z0-9._%\-'+/]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,22})$|[\s]+/,url:/(^(ht|f)tp(s?):\/\/[0-9a-zA-Z][-.\w]*(:[0-9])*(\/?)([a-zA-Z0-9\-.?,:'/\\+=&amp;%$#_[\]@!()*;~]*)?$)/,ampm:/^(AM|PM|am|pm)$/,hour:/^(0?[0-9]|1[0-9]|2[0-4])$/,minute:/^(0?[0-9]|[1-5][0-9]|60)$/,boolean:/^(true|false|TRUE|FALSE)$/,alphaNumeric:/([a-zA-Z0-9])+/,alphabetsOnly:/([a-zA-Z])+/,numeric:/([0-9])+/,phoneNo:/^[0-9a-zA-Z+.()\-;\s]+$/},Lyte.validate=function(e,t,r,o){var n=o.__data[t],i=!1;for(var a in n)if(!0!==(i=Lyte.checkProperty(a,r,t,n[a],e)))return i;return!1},Lyte.registerPattern=function(e,t){this.patterns[e]=t},Lyte.errorCodes={ERR01:"Primary key cannot be modified",ERR02:"Mandatory field cannot be empty",ERR03:"Type of value does not match the specified data type",ERR04:"Value is greater than the maximum value allowed",ERR05:"Value is less than the minimum value allowed",ERR06:"Length of string/array is greater than the maximum limit allowed",ERR07:"Length of string/array is less than the minimum limit allowed",ERR08:"String does not match the specified pattern",ERR09:"Values in array are not unique",ERR10:"Value is not equal to the specified constant",ERR11:"Model of related field is not defined",ERR12:"Model of backward relation is not defined",ERR13:"Record not found",ERR14:"Model does not match the related field model",ERR15:"Error in creating a record as a relation",ERR16:"Record with primary key already exists",ERR17:"Value cannot be changed because record has been deleted",ERR18:"Action not defined",ERR19:"Model not defined",ERR20:"Key not specified",ERR21:"'belongsTo' relationship expects a single object/id",ERR22:"Type not specified for polymorphic relation",ERR23:"Primary Key value not present",ERR24:"Error while relating record"},Lyte.registeredGlobalEvents={},Lyte.triggerEvent=function(){var e=Array.prototype.slice.call(arguments,1),t=arguments[0],r=this.registeredGlobalEvents[t];if(r)for(var o=0;o<r.listeners.length;o++){var n=r.listeners[o];n&&n.apply(this,e)}else r=this.registeredGlobalEvents[t]={listeners:[]};var i=new CustomEvent(t,{detail:e});document.dispatchEvent(i)},Lyte.addEventListener=function(e,t){if("function"==typeof t){var r=this.registeredGlobalEvents[e];return r||(r=this.registeredGlobalEvents[e]={listeners:[]}),e+"-"+(r.listeners.push(t)-1)}console.error("Second parameter to LyteComponent.addGlobalEventListener() must be a function")},Lyte.removeEventListener=function(e){if(e){var t=e.split("-"),r=this.registeredGlobalEvents[t[0]];r&&r.listeners[t[1]]?r.listeners[t[1]]=null:console.error("No such listener registered")}else console.error("listener unique id not specified")},Lyte.deepCopyObject=function(e){for(var t,r,o,n,i,a,s=[{source:e,target:Object.create(Object.getPrototypeOf(e))}],c=[e],d=s[0].target,l=[d];t=s.shift();)for(r=Object.getOwnPropertyNames(t.source),o=0;o<r.length;o++)(n=Object.getOwnPropertyDescriptor(t.source,r[o])).value&&"object"==typeof n.value?(i=n.value,n.value=Array.isArray(i)?[]:Object.create(Object.getPrototypeOf(i)),-1==(a=c.indexOf(i))?(c.push(i),l.push(n.value),Object.defineProperty(t.target,r[o],n),s.push({source:i,target:n.value})):(n.value=l[a],Object.defineProperty(t.target,r[o],n))):Object.defineProperty(t.target,r[o],n);return d},Lyte.resolvePromises=function(e){if(Array.isArray(e))return function(e){var t=[];return new Promise(function(r,o){Promise.all(e).then(function(o){e.forEach(function(e,r){t[r]=o[r]}),r(t)},function(e){o(e),console.error(e)})})}(e);if("object"==typeof e)return function(e){var t=[],r=[];if(Object.keys(e).forEach(function(o){t.push(o),r.push(e[o])}),r.length){var o={},n=new Promise(function(e,n){Promise.all(r).then(function(r){r.forEach(function(e,r){o[t[r]]=e}),e(o)},function(e){n(e),console.error(e)})});return n}return e}(e)},Lyte.createCustomElement=function(e,t){var r=t.constructor;delete t.constructor,this.defProperty=function(e,t,r){var o={};r.get&&(o.get=r.get),r.set&&(o.set=r.set),Object.defineProperty(e,t,o)};class o extends HTMLElement{constructor(){super(),r&&r.apply(this,Array.from(arguments))}}var n=t.static;if(n){for(var i in n)"object"==typeof n[i]?this.defProperty(o,i,n[i]):Object.defineProperty(o,i,{value:n[i]});delete t.static}for(var i in t)"object"==typeof t[i]?this.defProperty(o.prototype,i,t[i]):Object.defineProperty(o.prototype,i,{value:t[i]});t.static=n[i],t.constructor=r,"complete"===document.readyState||"interactive"===document.readyState?customElements.define(e,o):Lyte.toBeRegistered.push({name:e,def:o})},"complete"===document.readyState||"interactive"===document.readyState?domContentLoaded1():document.addEventListener("DOMContentLoaded",function(e){domContentLoaded1()},!0);function Adapter(e,r,t){var o=this;r&&r.mixins&&r.mixins.length&&r.mixins.forEach(function(e){var r=Lyte.registeredMixins[e];for(var t in r)o[t]=r[t]});for(key in e)this[key]=e[key];if(store.adapter.__toAddSuper&&store.adapter.__toAddSuper.hasOwnProperty(t)){for(var a=store.adapter.__toAddSuper[t],i=0;i<a.length;i++){var s=store.adapter[a[i]];s.isAdapter&&(s.$super=this)}delete store.adapter.__toAddSuper[t]}Object.defineProperty(this,"extends",{enumerable:!1,value:store.$.extendAdapter}),Object.defineProperty(this,"isAdapter",{value:!0,enumerable:!1}),Object.defineProperty(this,"__name",{value:t,enumerable:!1})}function Serializer(e,r,t){for(key in e)this[key]=e[key];var o=this;if(r&&r.mixins&&r.mixins.length&&r.mixins.forEach(function(e){var r=Lyte.registeredMixins[e];for(var t in r)o[t]=r[t]}),store.serializer.__toAddSuper&&store.serializer.__toAddSuper.hasOwnProperty(t)){for(var a=store.serializer.__toAddSuper[t],i=0;i<a.length;i++){var s=store.serializer[a[i]];s.isSerializer&&(s.$super=this)}delete store.serializer.__toAddSuper[t]}Object.defineProperty(this,"extends",{enumerable:!1,value:store.$.extendSerializer}),Object.defineProperty(this,"isSerializer",{value:!0,enumerable:!1}),Object.defineProperty(this,"__name",{value:t,enumerable:!1})}var $Record=function(){Object.assign(this,{isModified:!1,isNew:!1,isDeleted:!1,isError:!1,events:[],validatedOnCreate:!0,error:{}})},Record=function(e,r){Object.assign(this,r),Object.defineProperties(this,{$:{enumerable:!1,writable:!0,value:new $Record}});var t=store.modelFor(e);Object.defineProperties(this.$,{model:{enumerable:!1,value:t},record:{enumerable:!1,value:this},_attributes:{enumerable:!1,value:{},writable:!0},isDirty:{enumerable:!1,value:function(){var e=[];if(this.record.$.isModified)return!0;var r=this.model.relations;for(var t in r)for(var o=r[t],a=0;a<o.length;a++){var t=o[a];if(t.opts&&t.opts.serialize&&"record"===t.opts.serialize){var i=t.relKey,s=t.relType,n=this.record[i];if("belongsTo"===s&&n&&n.$&&n.$.isModified)e.push(i);else if("hasMany"===s)for(var d=0;d<n.length;d++)n[d]&&n[d].$&&n[d].$.isModified&&e.push(i)}}return e.length?e:!1}}});{var o=t.fieldList;new error1}for(var a in o){var i=o[a];if("relation"!=i.type){var s=r[a];(void 0==s||""===s||null==s)&&i.hasOwnProperty("default")&&(this[a]=i.default)}}var n=t._properties;Object.keys(n).length&&(this._bindings||Object.defineProperty(this,"_bindings",{value:new Set,enumerable:!1,writable:!0}),this._bindings.add(n),store.$.establishObserverBindings(this,n))};Object.defineProperties($Record.prototype,{get:{enumerable:!1,value:function(e){return this.record[e]}},set:{enumerable:!1,value:function e(r,e){if(this.isDeleted)store.$.setRecordError(this,this.model._primaryKey,"ERR17");else if("undefined"!=typeof LyteComponent){var t;if("string"==typeof r&&this.record[r]!==e)t=LyteComponent.set(this.record,r,e);else if("object"==typeof r){for(key in r)this.record[key]===r[key]&&delete r[key];t=LyteComponent.set(this.record,r,e)}if(t&&t.$&&t.$.isError)return t}else store.$.setData(this,r,e);return this.record}},getDirtyAttributes:{enumerable:!1,value:function(){var e=this._attributes,r=[];if(Object.keys(e).length)for(var t in e)r.push(t);return r}},rollBackAttributes:{enumerable:!1,value:function(e){Array.isArray(e)||(e=[e]);for(var r=this.record,t=[],o=this.model,a=0;a<e.length;a++){var i=e[a];if(this._attributes.hasOwnProperty(i)){var s=o.fieldList[i],n=this._attributes[i];"relation"==s.type?store.$.rollBackRecordsArray(n,r,o,s):"undefined"!=typeof LyteComponent?LyteComponent.set(r,i,n):r[i]=n,t.push(i),delete this._attributes[i],store.$.clearRecordError(this,i)}}if(Object.keys(this._attributes).length||(this.isModified=!1,this.isNew||store.$.deleteFromArray(o.dirty,this.get(o._primaryKey))),t.length>0){var d=[r,t];this.emit("change",d),o.emit("change",d)}}},rollBack:{enumerable:!1,value:function(){var e=this.model,r=e._primaryKey;if(this.isDeleted){var t=store.$.getIndex(e._deleted,r,this.get(r));store.$.rollBackDelete(e,t)}else this.isModified?this.rollBackAttributes(this.getDirtyAttributes()):this.isNew?store.$.rollBackNew(e,this.record,r):this.isError&&store.$.clearRecordError(this)}},deleteRecord:{enumerable:!1,value:function(){var e=this.model,r=this.record,t=e._primaryKey;store.$.removeFromStore(e,r[t])}},destroyRecord:{enumerable:!1,value:function(e){return this.deleteRecord(),this.save(e,"destroyRecord")}},addEventListener:{enumerable:!1,value:function(e,r){return store.$.eventListeners.add(this,e,r)}},removeEventListener:{enumerable:!1,value:function(e){store.$.eventListeners.remove(this,e)}},emit:{enumerable:!1,value:function(e,r){store.$.eventListeners.emit(this,e,r)}},triggerAction:{enumerable:!1,value:function(e,r){var t=this.model,o=t.actions,a=o?o[e]:void 0;return a?store.adapter.$.handleAction(e,t,this.record,r):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18,data:e})}},save:{enumerable:!1,value:function(e,r){var t=this.model,o=this.record,a=this.isDirty();if(this.isDeleted){if(!this.isNew)return store.adapter.$.del(t._name,o,!0,r,e);store.adapter.$.handleResponse(void 0,o,o,void 0,void 0,t)}else{if(this.isNew){var i=t.fieldList,s=new error1;for(var n in i){var d=o[n],l=i[n];if(!this.validatedOnCreate)if(null==d||void 0==d||""==d||0==d.length)l.mandatory&&store.$.setError(s,n,{code:"ERR02",message:Lyte.errorCodes.ERR02});else for(var c in l){var u=store.$.checkProperty(c,o[n],n,l[c]);if(1!=u){store.$.setError(s,n,u);break}}Lyte.Transform[l.type]&&Lyte.Transform[l.type].serialize&&(o[n]=Lyte.Transform[l.type].serialize(o[n]))}return Object.keys(s).length>0?Promise.reject(s):store.adapter.$.create(t._name,o,!0,e)}if(this.isModified||a&&a.length){var f={};for(var n in this._attributes)f[n]=Lyte.Transform[t.fieldList[n].type]&&Lyte.Transform[t.fieldList[n].type].serialize?Lyte.Transform[t.fieldList[n].type].serialize(o[n]):o[n];for(var y=0;y<a.length;y++)f[a[y]]=o[a[y]];var p=t._primaryKey;return f[p]=o.$.get(p),store.adapter.$.put(t._name,f,o,!0,e)}}return Promise.resolve()}},getInitialValues:{enumerable:!1,value:function(e){var r=!1;e?(Array.isArray(e)||(e=[e]),r=!0):e=this.getDirtyAttributes();for(var t={},o=this.record,a=0;a<e.length;a++)if(void 0!=o[e]&&o[e[a]].add){t[e[a]]=o[e[a]].slice(0);for(var i=this._attributes[e[a]],s=o[e[a]].model._primaryKey,n=i.length-1;n>=0;n--)if("added"==i[n]._type)for(var d=0;d<i[n].records.length;d++){var l=store.$.getIndex(t[e[a]],s,i[n].records[d][s]);-1!=l&&t[e[a]].splice(l,1)}else if("removed"==i[n]._type)for(var d=i[n].records.length-1;d>=0;d--)t[e[a]].splice(i[n]._indices[d],1,i[n].records[d]);else"changed"==i[n]._type&&(t[e[a]]=i[n].records)}else t[e[a]]=this._attributes[e[a]];return r?t[e[0]]:t}},toJSON:{enumerable:!1,value:function(){return Object.assign({},store.$.toJSON(this.model._name,this.record,!0))}}});var Model=function(e,r){Object.assign(this,{_name:e,_primaryKey:"id",fieldList:{id:{type:"string",primaryKey:!0}},relations:{},_properties:{},data:[],dirty:[],_deleted:[],events:{}});var t=[];for(var o in r){var a=r[o];if("observer"==a.type)t.push(a);else if("callBack"==a.type){a.observes&&t.push(a.observes);for(var i=a.properties,s=0;s<i.length;s++)"didLoad"===i[s]||"init"===i[s]?(this.didLoad||(this.didLoad=[]),this.didLoad.push(a.value)):("add"===i[s]||"change"===i[s])&&this.on(i[s],a.value);"didLoad"==o&&(this.didLoad||(this.didLoad=[]),this.didLoad.push(a.value))}else"didLoad"==o?(this.didLoad||(this.didLoad=[]),this.didLoad.push(a)):Object.keys(a).length&&(a.primaryKey&&(delete this.fieldList.id,this._primaryKey=o),this.fieldList[o]=r[o]);"relation"===a.type&&(a.relKey=o,this.relations[a.relatedTo]||(this.relations[a.relatedTo]=[]),this.relations[a.relatedTo].push(this.fieldList[o]))}"undefined"!=typeof LyteComponent&&LyteComponent.establishObserverBindings(t,!0,this._properties),Object.defineProperties(this.data,{model:{enumerable:!1,value:this},filterBy:{enumerable:!1,value:store.$.filterBy},sortBy:{enumerable:!1,value:store.$.sortBy},mapBy:{enumerable:!1,value:store.$.mapBy}}),Object.defineProperty(this,"extends",{enumerable:!1,value:store.$.extendModel})};Model.prototype.addEventListener=function(e,r){return store.$.eventListeners.add(this,e,r)},Model.prototype.removeEventListener=function(e){store.$.eventListeners.remove(this,e)},Model.prototype.emit=function(e,r){store.$.eventListeners.emit(this,e,r)},Model.prototype.on=function(e,r){return this.addEventListener(e,r)};var store={model:{},$:{setError:function(e,r,t){e.$.hasOwnProperty("error")?"undefined"!=typeof LyteComponent?LyteComponent.set(e.$.error,r,t):e.$.error[r]=t:console.error("Cannot set the error ",e," for ",r)},eventListeners:{add:function(e,r,t){return e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push({f:t}),r+"-"+(e.events[r].length-1)},remove:function(e,r){var t;if(r)if(/^(add|remove|change)$/.test(r))t=r,e.events&&e.events[t]?delete e.events[t]:void 0;else{var o=r?r.split("-"):void 0;if(o){var a=e.events[o[0]];a&&o[1]&&(a[o[1]]=null)}}else{var i=e.events;for(var s in i)i&&i[s]?delete i[s]:void 0}},emit:function(e,r,t){for(var o=e.events&&e.events[r]?e.events[r]:[],a=0;a<o.length;a++)o[a]?o[a].f.apply(null,t):void 0}},extendAdapter:function(e){var r;return e&&"string"==typeof e&&(r=store.adapter[e],r||(store.adapter.__toAddSuper||(store.adapter.__toAddSuper={}),store.adapter.__toAddSuper.hasOwnProperty(e)||(store.adapter.__toAddSuper[e]=[]),store.adapter.__toAddSuper[e].push(this.__name))),r&&r.isAdapter&&!this.$super&&(this.$super=r),this},extendSerializer:function(e){var r;return e&&"string"==typeof e&&(r=store.serializer[e],r||(store.serializer.__toAddSuper||(store.serializer.__toAddSuper={}),store.serializer.__toAddSuper.hasOwnProperty(e)||(store.serializer.__toAddSuper[e]=[]),store.serializer.__toAddSuper[e].push(this.__name))),r&&r.isSerializer&&!this.$super&&(this.$super=r),this},extendModel:function(e){if(e&&store.model[e]){var r=Object.assign({},store.model[e].fieldList);for(var t in r)"relation"==r[t].type&&delete r[t];this.fieldList=Object.assign(this.fieldList,r);var o=this._name;store.model[o].extend=e,store.model[e].extendedBy||(store.model[e].extendedBy={}),store.model[e].extendedBy[o]=!0,!store.adapter[o]&&store.adapter[e]&&(store.adapter[o]=store.adapter[e]),!store.serializer[o]&&store.serializer[e]&&(store.serializer[o]=store.serializer[e])}},establishObserverBindings:function(e,r,t){t||(t=e);for(key in r)!(e[key]instanceof Object)||e[key]._bindings&&e[key]._setterScope?e._setterScope||Object.defineProperty(e,"_setterScope",{value:e,enumerable:!1}):(e[key]._bindings||Object.defineProperty(e[key],"_bindings",{value:new Set,enumerable:!1,writable:!0}),t&&!e[key]._setterScope&&Object.defineProperty(e[key],"_setterScope",{value:t,enumerable:!1}),e[key]._bindings.add(r[key]),Object.keys(r[key]).length&&this.establishObserverBindings(e[key],r[key],e))},dataFromSocket:function(e,r,t){var o,a=store.modelFor(e),i=a._primaryKey;if(Array.isArray(t)||(t=[t]),"POST"===r)for(var s=0;s<t.length;s++)o=void 0,t&&(o=store.$.newRecord(e,t[s]),o.$.isNew=!1,store.$.deleteFromArray(a.dirty,o[i]));else if("PATCH"===r){for(var s=0;s<t.length;s++)if(o=void 0,t&&(o=store.peekRecord(e,t[s][i]),!o.$.isModified)){delete t[s][i];for(var n in t[s])LyteComponent.set(o,n,t[s][n],!0);o.$.isModified=!1}}else if("DELETE"===r)for(var s=0;s<t.length;s++)o=void 0,t&&(o=store.peekRecord(e,t[s][i]),o.$.isModified||store.unloadRecord(e,t[s][i]))},setData:function(e,r,t){var o={emit:!1,attr:[]};if(r instanceof Object)for(var a in r)this.setValue(e,a,r[a],o);else this.setValue(e,r,t,o);if(o.emit){var i=[e.record,o.attr];e.emit("change",i),e.model.emit("change",i),store.emit("change",[e.model._name,e.record,o.attr])}return e.record},setValue:function(e,r,t,o){var a=e.model;if(r!=a._primaryKey){var i=a.fieldList[r],s=e.record;if(i)if(void 0!=t&&null!=t&&""!=t||!i.mandatory){if(i.relType){var n,d={};if(this.getRelations(a,i.relKey,store.modelFor(i.relatedTo),d),s[r]&&"hasMany"==i.relType?(n=s[r].slice(0),this.toDemolishLink(a,s,d.forward),s[r].splice(0,s[r].length)):s[r]&&"belongsTo"==i.relType&&(n=this.createCopy(s[r]),this.toDemolishLink(a,s,d.forward),s[r]=void 0),Array.isArray(t)){if("belongsTo"==i.relType)return this.revertToOldVal(s,r,n,d),void store.$.setRecordError(e,r,"ERR21",t)}else t=[t];for(var l=store.modelFor(i.relatedTo),c=l._primaryKey,u=l.fieldList[c].type,f=[],y=0;y<t.length;y++)if(void 0!=t[y]){var p=t[y];if(typeof t[y]==u){if(p=store.peekRecord(t[y]._type?t[y]._type:i.relatedTo,t[y]),p.$&&p.$.isError){f.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},p)});continue}}else if("object"==typeof t[y]){if(p.$&&p.$.isError){f.push({code:"ERR15",message:Lyte.errorCodes.ERR15,error:Object.assign({},p)});continue}if(!Lyte.isRecord(p)&&(p=this.newRecord(t[y]._type?t[y]._type:i.relatedTo,t[y]),p.$.isError)){f.push({code:"ERR15",data:t[y],message:Lyte.errorCodes.ERR15,error:Object.assign({},p)});continue}}var h=this.establishLink(d.forward,d.backward,s,p);1!=h&&f.push({code:h,data:t[y],message:Lyte.errorCodes[h]})}if(f.length&&f.length==t.length)return this.revertToOldVal(s,r,n,d),void("belongsTo"==i.relType?store.$.setRecordError(e,r,f[0]):store.$.setRecordError(e,r,f));f.length>1?store.$.setRecordError(e,r,f):store.$.clearRecordError(e,r),s.$._attributes.hasOwnProperty(r)||(s.$._attributes[r]=[]),s.$._attributes[r].push({_type:"changed",records:n}),o.emit=!0,o.attr.push(r);var m=s.$.getInitialValues(r),h=!0;if(m&&Array.isArray(s[r])&&m.length==s[r].length){h=!1;for(var y=0;y<m.length;y++)if(!store.$.compareRecords(m[y],s[r][y],c)){h=!0;break}}h||delete s.$._attributes[r]}else if(t!=s[r]){if(void 0!=t)for(var v in i){var g=this.checkProperty(v,t,r,i[v]);if(1!=g)return void store.$.setRecordError(e,r,g,t)}var R=s.$._attributes[r];s.$._attributes.hasOwnProperty(r)||void 0==t?("object"==typeof t&&store.adapter.$.compareObjects(R,t)||R==t)&&delete s.$._attributes[r]:s.$._attributes[r]=this.createCopy(s[r]),"undefined"!=typeof LyteComponent?LyteComponent.set(s,r,t,!0):s[r]=t,o.emit=!0,o.attr.push(r),store.$.clearRecordError(e,r)}}else store.$.setRecordError(e,r,"ERR02");else s[r]=t,o.emit=!0,o.attr.push(r);Object.keys(s.$._attributes).length?(e.isModified=!0,this.checkAndAddToArray(a.dirty,s[a._primaryKey])):(e.isModified=!1,e.isNew||this.deleteFromArray(a.dirty,s[a._primaryKey]))}else store.$.setRecordError(e,r,"ERR01",t)},checkForCorrectRelation:function(e,r){var t=e.relatedTo;return Lyte.isRecord(r)?e.opts&&e.opts.polymorphic?r.$.model.extend?e.relatedTo===r.$.model.extend:!1:e&&r?t===r.$.model._name:!1:!1},removeKeys:function(e,r){for(var t in r)if(e.hasOwnProperty(t)){var o=e[t];("belongsTo"===o.type||"hasMany"===o.type&&r[t])&&this.removeNotDefinedKeys(o.relatedTo,r[t],o.opts&&o.opts.polymorphic?!0:void 0)}else delete r[t]},removeNotDefinedKeys:function(e,r,t){var o=e.fieldList;if(Array.isArray(r))for(var a=0;a<r.length;a++){var i=r[a];this.removeKeys(t&&Lyte.isRecord(i)?i.$.model.fieldList:o,i)}else this.removeKeys(t&&Lyte.isRecord(i)?i.$.model.fieldList:o,i)},add:function(e,r){var t=this.record,o=t.$.model,a=this.key,i=o.fieldList[a],s={};store.$.getRelations(o,i.relKey,store.modelFor(i.relatedTo),s),Array.isArray(e)||(e=[e]);for(var n=store.modelFor(s.forward.relatedTo)._primaryKey,d=[],l=[],c=0;c<e.length;c++){var u=e[c];if("object"!=typeof u||Lyte.isRecord(u)){if(store.modelFor(s.forward.relatedTo).fieldList[n].type.toLowerCase()==typeof u){if(this.polymorphic&&!r){d.push({code:"ERR22",data:e[c],message:Lyte.errorCodes.ERR22});continue}u=store.peekRecord(r?r:s.forward.relatedTo,u)}}else u=store.$.newRecord(u._type?u._type:r?r:i.relatedTo,u);var f=u&&u._type?u._type:r?r:void 0;if(void 0==u)d.push({code:"ERR13",data:e[c],message:Lyte.errorCodes.ERR13});else if(u.$&&u.$.isError)d.push({code:"ERR15",data:e[c],message:Lyte.errorCodes.ERR15,error:u});else if(Lyte.isRecord(u)&&!store.$.hasDuplicateRelation(u,t[a],n,f)){var y=store.$.establishLink(s.forward,s.backward,t,u);1!=y?d.push({code:y,data:e[c],message:Lyte.errorCodes[y]}):l.push(u)}}return l.length&&(t.$._attributes[a]||(t.$._attributes[a]=[]),t.$._attributes[a].push({_type:"added",records:l}),store.$.emit("change",t,[a]),store.$.hasRecordsArrayChanged(t,a)?(t.$.isModified=!0,store.$.checkAndAddToArray(o.dirty,t[o._primaryKey])):(t.$.isModified=!1,delete t.$._attributes[a],t.$.isNew||store.$.deleteFromArray(o.dirty,t[o._primaryKey]))),d.length>0?store.$.setRecordError(t.$,a,d):store.$.clearRecordError(t.$,a),t},remove:function(e,r){var t=this.record,o=t.$.model,a=this.key,i=o.fieldList[a],s={};store.$.getRelations(o,i.relKey,store.modelFor(i.relatedTo),s),Array.isArray(e)||(e=[e]);for(var n,d=store.modelFor(s.forward.relatedTo)._primaryKey,l=[],c=[],u=[],f=0;f<e.length;f++){if(store.modelFor(s.forward.relatedTo).fieldList[d].type.toLowerCase()==typeof e[f]){if(1==this.polymorphic&&!r){l.push({code:"ERR22",data:e[f],message:Lyte.errorCodes.ERR22});continue}n=store.peekRecord(r?r:s.forward.relatedTo,e[f])}else Lyte.isRecord(e[f])&&(n=e[f]);var y=n&&n._type?n._type:r?r:void 0;if(n){var p=store.$.getIndex(t[a],d,n.$.get(d),y);store.$.demolishLink(n,d,store.peekRecord(s.backward.relatedTo,t[o._primaryKey]),s.forward.relKey),store.$.demolishLink(t,o._primaryKey,store.peekRecord(y?y:s.forward.relatedTo,n[d]),s.backward.relKey),c.push(n),u.push(p)}}c.length&&(t.$._attributes[a]?store.$.hasRecordsArrayChanged(t,a)?t.$._attributes[a].push({_type:"removed",records:c,indices:u}):(t.$.isModified=!1,delete t.$._attributes[a],t.$.isNew||store.$.deleteFromArray(o.dirty,t[o._primaryKey])):(t.$._attributes[a]=[{_type:"removed",records:c,_indices:u}],t.$.isModified=!0,store.$.checkAndAddToArray(o.dirty,t[o._primaryKey])),store.$.emit("change",t,[a])),l.length>0?store.$.setRecordError(t.$,a,l):store.$.clearRecordError(t.$,a)},filter:function(e,r,t){var o=0;for(var a in r)e[a]===r[a]&&o++;return o===t?!0:void 0},filterBy:function(e){for(var r=Object.keys(e).length,t=[],o=0;o<this.length;o++)store.$.filter(this[o],e,r)&&t.push(this[o]);return t.filterBy||Object.defineProperties(t,{model:{enumerable:!1,value:this.model},filterBy:{enumerable:!1,value:this.filterBy},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:store.$.mapBy}}),t},removeSelfCircularReference:function(e,r,t){var o=store.modelFor(e),a=o.fieldList;for(var i in r){var s=a[i];if(r[i]&&s&&"relation"==s.type){var n=store.modelFor(s.relatedTo);if(void 0==n)continue;var d=s.relKey,l={};this.getRelations(o,d,n,l);var c=s.opts?s.opts.serialize:void 0,u=r[d],f=o._primaryKey,y=r[f];if(t||"id"==c)Array.isArray(u)?r[d]=u.map(function(e){return e[f]}):u&&Lyte.isRecord(u)&&(r[d]=u[n._primaryKey]);else if("record"===c)if(Array.isArray(u)){u=Array.from(u);for(var p=0;p<u.length;p++)u[p]&&Lyte.isRecord(u[p])&&(this.removeBackwardRel(u[p],l,f,y),this.removeSelfCircularReference(n._name,u[p],t))}else u&&Lyte.isRecord(u)&&(this.removeBackwardRel(u,l,f,y),this.removeSelfCircularReference(n._name,u,t));else delete r[d]}}},removeBackwardRel:function(e,r,t,o){var a=e[r.backward.relKey];if(Array.isArray(a)){for(var i=0;i<a.length;i++)if(a[i][t]===o)return a.splice(i,1),void(0==a.length&&delete e[r.backward.relKey])}else a&&Lyte.isRecord(a)&&a[t]==o&&delete e[r.backward.relKey]},toJSON:function(e,r,t){var o;if(Array.isArray(r)){for(var a=[],i=0;i<r.length;i++)o=this.deepCopyObject(r[i]),this.removeSelfCircularReference(e,o,t),a.push(o);return a}return("object"==typeof r||Lyte.isRecord(r))&&(o=this.deepCopyObject(r),this.removeSelfCircularReference(e,o,t)),o},deepCopyObject:function(e){for(var r,t,o,a,i,s,n=[{source:e,target:Object.create(Object.getPrototypeOf(e))}],d=[e],l=n[0].target,c=[l];r=n.shift();)for(t=Object.getOwnPropertyNames(r.source),o=0;o<t.length;o++)a=Object.getOwnPropertyDescriptor(r.source,t[o]),a.value&&"object"==typeof a.value?(i=a.value,a.value=Array.isArray(i)?[]:Object.create(Object.getPrototypeOf(i)),s=d.indexOf(i),-1==s?(d.push(i),c.push(a.value),Object.defineProperty(r.target,t[o],a),n.push({source:i,target:a.value})):(a.value=c[s],Object.defineProperty(r.target,t[o],a))):Object.defineProperty(r.target,t[o],a);return l},createCopy:function(e){if(Array.isArray(e)){if(e.save){for(var r=[],t=0;t<e.length;t++){var o=this.deepCopyObject(e[t]);r.push(o)}return r}}else if(e&&(Lyte.isRecord(e)||"object"==typeof e))return this.deepCopyObject(e);return e},compareRecords:function(e,r,t,o){if(Lyte.isRecord(e)&&Lyte.isRecord(r)&&t){var a=e.$.get(t),i=r.$.get(t);return o&&e._type&&o!==e._type?!1:a===i}return!1},hasRecordInArray:function(e,r,t,o){if(Lyte.isRecord(r)&&t)for(var a=0;a<e.length;a++)if((!o||e[a]._type===o)&&this.compareRecords(e[a],r,t))return!0;return!1},hasDuplicateRelation:function(e,r,t,o){return Array.isArray(r)?this.hasRecordInArray(r,e,t,o):r&&Lyte.isRecord(r)?this.compareRecords(e,r,t,o):!1},checkPresenceInArray:function(e,r){return e.some(function(e){return e===r})},checkAndAddToArray:function(e,r){this.checkPresenceInArray(e,r)||e.push(r)},deleteFromArray:function(e,r){for(var t=0;t<e.length;t++)e[t]==r&&e.splice(t,1)},newRecord:function(e,r,t){var o=store.modelFor(e);if(void 0==o)return new error1("id",{code:"ERR19",data:e,message:Lyte.errorCodes.ERR19,data:e});void 0==r&&(r={});var a=o.fieldList,i={},s=new error1;for(var n in a){var d=a[n];"hasMany"==d.relType&&(i[n]=[]);var l=r[n];if(void 0==l||""==l||null==l)d.hasOwnProperty("default")&&(i[n]=d.default),d.mandatory&&!t&&store.$.setError(s,n,{code:"ERR02",message:Lyte.errorCodes.ERR02});else if("relation"!=d.type&&!t)for(var c in d){var u=this.checkProperty(c,l,n,d[c],r);1!=u&&store.$.setError(s,n,u)}}for(var f in r)i[f]=r[f];i=new Record(e,i);var y=o.relations;for(var p in y)for(var h=y[p],m=0;m<h.length;m++)if(i&&i[h[m].relKey]){var v=r[h[m].relKey];i[h[m].relKey]=void 0;var d=h[m],g={},u=this.getRelations(o,d.relKey,store.modelFor(d.relatedTo),g);if(1!=u){store.$.setError(s,d.relKey,{code:u,data:h,message:Lyte.errorCodes[u]});continue}var R=store.modelFor(d.relatedTo),b=R.fieldList[R._primaryKey].type;if(Array.isArray(v)){if("belongsTo"==h[m].relType){store.$.setError(s,d.relKey,{code:"ERR21",data:v,message:Lyte.errorCodes.ERR21});continue}}else v=[v];s[d.relKey]=[];for(var $=0;$<v.length;$++){var L=void 0;v[$]&&Lyte.isRecord(v[$])?L=v[$]:v[$]&&typeof v[$]==b.toLowerCase()?L=store.peekRecord(d.relatedTo,v[$]):v[$]&&"object"==typeof v[$]&&(L=this.newRecord(d.relatedTo,v[$])),L&&L.$&&L.$.isError?store.$.setError(s,d.relKey,{code:"ERR15",data:v[$],message:Lyte.errorCodes.ERR15,error:Object.assign({},L)}):L&&L.$&&!L.$.isError&&(u=this.establishLink(g.forward,g.backward,i,L),1!=u&&store.$.setError(s,d.relKey,{code:u,data:v[$],message:Lyte.errorCodes[u]}))}if(0==s[d.relKey].length&&delete s[d.relKey],"hasMany"==h[m].relType){var _=h[m].relKey;void 0==i[_]&&(i[_]=[]),i[_].add||(h[m].opts&&h[m].opts.polymorphic&&Object.defineProperty(i[_],"polymorphic",{enumerable:!1,value:!0}),Object.defineProperties(i[_],{record:{enumerable:!1,writable:!0,value:i},key:{enumerable:!1,value:_},filterBy:{enumerable:!1,value:this.filterBy},add:{enumerable:!1,value:this.add},remove:{enumerable:!1,value:this.remove},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:this.mapBy}}))}}var k=o._primaryKey;if(i[k])this.isDuplicateRecord(o.data,i,k)&&store.$.setError(s,k,{code:"ERR16",data:i[k],message:Lyte.errorCodes.ERR16});else{var A=a[k].type,E=i[k]=Math.floor(1e5*Math.random()+1);for("string"==A&&(i[k]=E.toString());this.isDuplicateRecord(o.data,i,k);){var E=i[k]=Math.floor(1e5*Math.random()+1);"string"==A&&(i[k]=E.toString())}}return Object.keys(s).length>0?s:(i.$.isNew=!0,"undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(o.data,"push",i):o.data.push(i),this.checkAndAddToArray(o.dirty,i[o._primaryKey]),o.emit("add",[i]),store.emit("add",[o._name,i]),t&&(i.$.validatedOnCreate=!1),i)},insertIntoStore:function(e,r){var t;if(Array.isArray(r)){t=[];for(var o=0;o<r.length;o++)t[o]=this.insertIntoStore(e,r[o]),t[o]&&t[o].$&&t[o].$.isError&&(t.$=t.$||Object.defineProperty(t,"$",{enumerable:!1,value:{}}),t.$.isError=!0)}else if(r&&Object.keys(r).length){var a=e;if(r._type&&(a=e.extendedBy[r._type]?store.modelFor(r._type):void 0),Lyte.isRecord(r))return void 0;t=this.isDuplicateRecord(a.data,r,a._primaryKey)?this.validateAndMerge(a,r):this.validateAndPush(a,new Record(a._name,r))}return t},removeFromStore:function(e,r,t){var o=e.data;if(0!=o.length){Array.isArray(r)||(r=[r]);for(var a=e._primaryKey,i=0;i<r.length;i++){var s=this.getIndex(o,a,r[i]);if(-1!=s){Object.keys(e.relations).length&&this.toDemolishRelation(e,s);var n;n="undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(o,"removeAt",s,1):o.splice(s,1),n&&!t&&(n[0].$.isDeleted=!0,(n[0].$.isNew||n[0].$.isModified)&&store.$.deleteFromArray(e.dirty,n[0][a]),e._deleted.push(n[0]),e.emit("remove",[n[0]]),store.emit("remove",[e._name,n[0]]))}}}},getIndex:function(e,r,t,o){for(var a=0;e&&a<e.length;a++)if((!o||e[a]._type===o)&&e[a][r]==t)return a;return-1},isDuplicateRecord:function(e,r,t){return e.length?e.some(function(e){return r[t]==e[t]?!0:void 0}):!1},validateAndPush:function(e,r){if(e.rel||(e.rel={}),!r.hasOwnProperty(e._primaryKey))return new error1(e._primaryKey,{code:"ERR23",data:r,message:Lyte.errorCodes.ERR23});if(r=this.validateJSON(e,r),!r.$.isError){if(e.didLoad)for(var t=e.didLoad,o=0;o<t.length;o++)t[o].apply(r);this.isDuplicateRecord(e.data,r,e._primaryKey)?this.mergeData(store.peekRecord(e._name,r[e._primaryKey]),r):("undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(e.data,"push",r):e.data.push(r),e.emit("add",[r]),store.emit("add",[e._name,r]))}return r},validateAndMerge:function(e,r){e.rel||(e.rel={});var t=e._primaryKey,o=store.peekRecord(e._name,r[t]);if(!o||!Lyte.isRecord(o))return void console.error("No such record to merge, ",r);var a=this.mergeData(o,r);if(o=this.validateJSON(e,o,Object.keys(r),a),!o.$.isError&&e.didLoad)for(var i=e.didLoad,s=0;s<i.length;s++)i[s].apply(o);return o},mergeData:function(e,r){if(e&&r){var t,o=e.$.model,a=(o._primaryKey,{}),i={};for(var s in r)if(t=o.fieldList[s]){if("relation"!=t.type)"undefined"!=typeof LyteComponent?LyteComponent.set(e,s,r[s],!0):e[s]=r[s],a[s]=t;else if(t&&"relation"==t.type)switch(this.compareRelations(e,r,s,t)){case 0:var n={};store.$.getRelations(e.$.model,s,store.modelFor(e.$.model.fieldList[s].relatedTo),n),this.toDemolishLink(e.$.model,e,n.forward),"undefined"!=typeof LyteComponent?LyteComponent.set(e,s,r[s],!0):e[s]=r[s],a[s]=t;break;case 1:break;case 2:this.mergeData(e[s],r[s]);break;case 3:a[s]=t,i[s]=r[s]}}else"undefined"!=typeof LyteComponent?LyteComponent.set(e,s,r[s],!0):e[s]=r[s];return{toValidate:a,toPartialAdd:i}}},compareRelations:function(e,r,t,o){var a=store.modelFor(o.relatedTo)._primaryKey;if("belongsTo"==o.relType)return this.compareRecordWithObj(e[t],r[t],a);for(var i=r[t].length,s=0,n=1,d=0;i>d;d++){var l=r[t][d],c=this.getIndex(e[t],a,"object"==typeof l?l[a]:l);if(-1!=c){var u=this.compareRecordWithObj(e[t][c],l,a);(1==u||2==u)&&s++,2==u&&this.mergeData(e[t][c],l)}else n=0}return 0==n?s>0&&s==e[t].length?3:0:1},compareRecordWithObj:function(e,r,t){if(!e)return 0;var o=e.$.model,a=o.fieldList;if(!Lyte.isRecord(e))return 0;var i=o.fieldList[t];if(typeof r==i.type)return e[t]==r?1:0;if("object"==typeof r){if(e[t]!=r[t])return 0;for(var s in r){var i=a[s];if(i)if("relation"==i.type){var n=this.compareRelations(e,r,s,i);if(!n)return 0}else if(e[s]!=r[s])return 2}return 1}return 0},checkProperty:function(e,r,t,o,a){switch(e){case"type":if(Lyte.Transform.hasOwnProperty(o)){if(Array.isArray(r)){if("array"!=Lyte.Transform[o].extends)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(Lyte.Transform[o].extends!=typeof r)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(Array.isArray(r)){if("array"!=o)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o}}else if(o!=typeof r)return{code:"ERR03",message:Lyte.errorCodes.ERR03,expected:o};break;case"maximum":if("number"==typeof r&&r>o)return{code:"ERR04",message:Lyte.errorCodes.ERR04,expected:o};break;case"minimum":if("number"==typeof r&&o>r)return{code:"ERR05",message:Lyte.errorCodes.ERR05,expected:o};break;case"maxLength":case"maxItems":if(r.length>o)return{code:"ERR06",message:Lyte.errorCodes.ERR06,expected:o};break;case"minLength":case"minItems":if(r.length<o)return{code:"ERR07",message:Lyte.errorCodes.ERR07,expected:o};break;case"pattern":if("string"==typeof r&&!new RegExp(o).test(r))return{code:"ERR08",message:Lyte.errorCodes.ERR08,expected:o};break;case"uniqueItems":if(Array.isArray(r)&&o)for(var i=[],s=0;s<r.length;s++){var n=r[s];if(-1!=i.indexOf(n))return{code:"ERR09",message:Lyte.errorCodes.ERR09};i.push(n)}break;case"constant":if(Array.isArray(r)){var d=r.length==o.length&&r.every(function(e,r){return e===o[r]});if(!d)return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if("object"==typeof r){var d=store.adapter.$.compareObjects(r,o);if(!d)return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o}}else if(r!=o)return{code:"ERR10",message:Lyte.errorCodes.ERR10,expected:o};break;case"items":if(Array.isArray(r))for(var s=0;s<r.length;s++)for(var e in o){var d=this.checkProperty(e,r[s],s,o[e]);if(1!=d)return d}break;case"properties":if("object"==typeof r&&!Array.isArray(r))for(var t in r)for(var e in o){var d=this.checkProperty(e,r[t],t,o[e]);if(1!=d)return d}break;case"validation":var d=Lyte.customValidator[o].apply(a,[t,r]);if(1!=d)return d}return!0},validateJSON:function(e,r,t,o){var a=o?o.toValidate:void 0,i=a&&Object.keys(a).length?a:e.fieldList;for(var s in i)if(!t||-1!=t.indexOf(s))if("relation"==i[s].type&&r[s]){var n=o&&o.toPartialAdd?o.toPartialAdd[s]:void 0,d=this.handleRelation(s,e,i[s],r,n);if(1!=d)return new error1(s,{code:d,data:r,message:Lyte.errorCodes[d]});"hasMany"!=i[s].relType||r[s].add||Object.defineProperties(r[s],{record:{enumerable:!1,value:r},model:{enumerable:!1,value:e},key:{enumerable:!1,value:s},filterBy:{enumerable:!1,value:this.filterBy},add:{enumerable:!1,value:this.add},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:this.mapBy},remove:{enumerable:!1,value:this.remove}})}else{var l=i[s];void 0==r[s]&&l.default&&(r[s]=l.default),r[s]&&Lyte.Transform.hasOwnProperty(l.type)&&Lyte.Transform[l.type].hasOwnProperty("deserialize")&&(r[s]=Lyte.Transform[l.type].deserialize(r[s]))}return r},handleRelation:function(e,r,t,o,a){var i={};if(r.rel.hasOwnProperty(e))i=r.rel[e];else{if(void 0==store.modelFor(t.relatedTo))return"ERR11";this.getRelations(r,e,store.modelFor(t.relatedTo),i),r.rel[e]=i}return this.solveRelation(i,r,store.modelFor(t.relatedTo),e,o,a)},getRelations:function(e,r,t,o){return void 0==t?"ERR11":(o.forward=e.fieldList[r],o.backward=this.getBackwardRel(e,o.forward,t),!0)},getBackwardRel:function(e,r,t){var o,a;if(r.opts&&(o=r.opts.inverse,a=r.opts.polymorphic)){var i=t.extendedBy;if(i)for(var s in i){var n=store.modelFor(s);if(n.relations[e._name]){t=n;break}}}var d;if(o&&""!=o)d=o;else{var l=t.relations[e._name],c=store.modelFor(e.extend);!l&&c&&t.relations[c._name]&&t.relations[c._name].opts&&t.relations[c._name].opts.polymorphic&&(l=t.relations[c._name]),d=l&&1==l.length?l[0].relKey:void 0}if(!d){var u=t.relations[e._name],f=store.modelFor(e.extend);if(!u&&f&&t.relations[f._name]&&t.relations[f._name].opts&&t.relations[f._name].opts.polymorphic&&(u=t.relations[f._name]),u)for(var y=0;y<u.length;y++)if(u[y]&&u[y].opts&&u[y].opts.inverse===r.relKey){d=u[y].relKey;break}}return d?t.fieldList[d]:void 0},solveRelation:function(e,r,t,o,a,i){var s=e.backward,n=e.forward;if(!s&&(n.relatedTo===r._name&&(s=n),!s))return"ERR12";if(i)d=i;else{if(a[o]&&(a[o].add||Lyte.isRecord(a[o])))return!0;if(Array.isArray(a[o])){if("belongsTo"==n.relType)return"ERR21"}else a[o]=[a[o]];var d=a[o].splice(0,a[o].length);"belongsTo"==n.relType&&(a[o]=void 0)}for(var l=0;l<d.length;l++){var c;if(typeof d[l]==t.fieldList[t._primaryKey].type?c=store.peekRecord(t._name,d[l]):"object"!=typeof d[l]||Lyte.isRecord(d[l])||(c=this.insertIntoStore(t,d[l])),c&&c.$&&c.$.isError){a.$.isError=!0;
var u={code:"ERR24",message:Lyte.errorCodes.ERR24,data:a,error:c.$.error};"undefined"!=typeof LyteComponent?LyteComponent.set(a.$.error,o,u):a.$.error[o]=u}else c&&(this.hasDuplicateRelation(c,a[o],t._primaryKey,d[l]._type)||this.establishLink(n,s,a,c))}return!0},establishLink:function(e,r,t,o,a){if(!o)return"ERR13";if(!this.checkForCorrectRelation(e,o))return"ERR14";var i=e.relKey,s=o._type;if("belongsTo"==e.relType)t[i]!==o&&("undefined"!=typeof LyteComponent?LyteComponent.set(t,i,o,!0):t[i]=o);else if("hasMany"===e.relType){if(t[i]||("undefined"!=typeof LyteComponent?LyteComponent.set(t,i,[],!0):t[i]=[]),!t[i].model){var n=o.$.model;s&&(Object.defineProperty(t[i],"polymorphic",{enumerable:!1,value:!0}),n=store.modelFor(n.extend)),store.$.establishObserverBindings(t,t.$.model._properties),Object.defineProperties(t[i],{record:{enumerable:!1,value:t},model:{enumerable:!1,value:n},key:{enumerable:!1,value:i},filterBy:{enumerable:!1,value:this.filterBy},add:{enumerable:!1,value:this.add},remove:{enumerable:!1,value:this.remove},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:store.$.mapBy}})}this.hasDuplicateRelation(o,t[i],e?store.modelFor(e.relatedTo)._primaryKey:void 0,s)||(void 0!=a?t[i].splice(a,0,o):"undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(t[i],"push",o):t[i].push(o))}if(e==r)return!0;if(!this.checkForCorrectRelation(r,t))return"ERR14";var d=r.relKey;return"belongsTo"==r.relType?(void 0!=o[d]&&o[r.relKey]!==t&&this.toDemolishLink(o.$.model,o,r),o[d]!==t&&("undefined"!=typeof LyteComponent?LyteComponent.set(o,d,t,!0):o[d]=t)):"hasMany"===r.relType&&(o[d]||("undefined"!=typeof LyteComponent?LyteComponent.set(o,d,[],!0):o[d]=[]),o[d].model||Object.defineProperties(o[d],{record:{enumerable:!1,value:o},model:{enumerable:!1,value:t.$.model},key:{enumerable:!1,value:d},filterBy:{enumerable:!1,value:this.filterBy},add:{enumerable:!1,value:this.add},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:this.mapBy},remove:{enumerable:!1,value:this.remove}}),this.hasDuplicateRelation(t,o[d],r?store.modelFor(r.relatedTo)._primaryKey:void 0,s)||("undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(o[d],"push",t):o[d].push(t))),!0},toDemolishRelation:function(e,r){var t=e.data[r],o=e.relations;for(var a in o)for(var i=o[a],s=0;s<i.length;s++){var n=i[s];t[n.relKey]&&this.toDemolishLink(e,t,n)}},toDemolishLink:function(e,r,t){var o=r[t.relKey],a=e._primaryKey,i=store.modelFor(t.relatedTo),s=(i._primaryKey,t.relatedTo,this.getBackwardRel(e,t,i));if(Array.isArray(o))for(var n=0;n<o.length;n++)this.demolishLink(r,a,o[n],s.relKey);else Lyte.isRecord(o)&&this.demolishLink(r,a,o,s.relKey)},demolishLink:function(e,r,t,o){var a=t[o];if(Array.isArray(a)){var i=this.getIndex(a,r,e[r],e._type);-1!=i&&("undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(t[o],"removeAt",i,1):t[o].splice(i,1))}else a&&("object"==typeof a||Lyte.isRecord(a))&&delete t[o]},toInsertData:function(e,r){var t=store.modelFor(e),o=this.insertIntoStore(t,r[e]);return delete t.rel,o},rollBackRecordsArray:function(e,r,t,o){var a={},i=t._primaryKey,s=store.modelFor(o.relatedTo)._primaryKey;store.$.getRelations(t,o.relKey,store.modelFor(o.relatedTo),a);for(var n=e.length-1;n>=0;n--){var d=e[n].records;if("added"==e[n]._type)for(var l=0;l<d.length;l++){var c=d[l];this.demolishLink(c,s,r,a.forward.relKey),this.demolishLink(r,i,c,a.backward.relKey)}else if("removed"==e[n]._type)for(var l=d.length-1;l>=0;l--){var c=d[l];this.establishLink(a.forward,a.backward,r,c,e[n]._indices[l])}else if("changed"==e[n]._type){var u=r[o.relKey];for(Array.isArray(u)||(u=[u]);u.length;){var c=u[0];if(this.demolishLink(c,s,r,a.forward.relKey),this.demolishLink(r,i,c,a.backward.relKey),"belongsTo"==a.forward.relType)break}Array.isArray(d)||(d=[d]);for(var l=0;l<d.length;l++){var c=d[l];this.establishLink(a.forward,a.backward,r,c)}}}},sortBy:function(e,r){var t=store.$.mapBy.call(this,e),o=this.model,a=o.fieldList[e];a&&"string"==a.type?(t.sort(),"desc"==r&&t.reverse()):(t.sort(function(e,r){return e-r}),"desc"==r&&t.sort(function(e,r){return r-e}));for(var i=this.slice(0),s=[],n=0;n<t.length;n++)if(void 0!=t[n]){var d=store.$.getIndex(i,e,t[n]);s.push(i[d]),i.splice(d,1)}return i.length>0&&(s="desc"==r?s.concat(i):i.concat(s)),Object.defineProperties(s,{model:{enumerable:!1,value:this.model},filterBy:{enumerable:!1,value:this.filterBy},sortBy:{enumerable:!1,value:this.sortBy},mapBy:{enumerable:!1,value:this.mapBy}}),s},mapBy:function(e){return this.map(function(r){return r.$.get(e)})},revertToOldVal:function(e,r,t,o){if(void 0!=t&&0!=t.length){Array.isArray(t)||(t=[t]);for(var a=0;a<t.length;a++)this.establishLink(o.forward,o.backward,e,t[a])}},rollBackDelete:function(e,r){var t=e._deleted,o=t.splice(r,1)[0];o.$.isDeleted=!1,"undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(e.data,"push",o):e.data.push(o),(o.$.isNew||o.$.isModified)&&this.checkAndAddToArray(e.dirty,o[e._primaryKey]),store.$.clearRecordError(o.$,e._primaryKey,"ERR17"),e.emit("add",[o]),store.emit("add",[e._name,o])},rollBackNew:function(e,r,t){var o=this.getIndex(e.data,t,r[t]);"undefined"!=typeof Lyte.arrayUtils?Lyte.arrayUtils(e.data,"removeAt",o,1):e.data.splice(o,1),r.$.isNew=!1,e.emit("delete",[r]),store.emit("delete",[e._name,r]),this.deleteFromArray(e.dirty,r[t])},emit:function(e,r,t){r.$.emit(e,[r,t]),r.$.model.emit(e,[r,t]),store.emit(e,[r.$.model._name,r,t])},hasRecordsArrayChanged:function(e,r){var t=e.$.getInitialValues(r),o=!0,a=e.$.model._primaryKey;if(t&&t.length==e[r].length){o=!1;for(var i=0;i<t.length;i++)if(!this.compareRecords(t[i],e[r][i],a))return!0}return o},setRecordError:function(e,r,t,o){e.isError=!0,"object"==typeof t?"undefined"!=typeof LyteComponent?LyteComponent.set(e.error,r,t):e.error[r]=t:("undefined"!=typeof LyteComponent?LyteComponent.set(e.error,r,{code:t,message:Lyte.errorCodes[t]}):e.error[r]={code:t,message:Lyte.errorCodes[t]},o&&("undefined"!=typeof LyteComponent?LyteComponent.set(e.error.field,"value",o):e.error[r].value=o))},clearRecordError:function(e,r,t){if(t)e.error.code==t&&("undefined"!=typeof LyteComponent?Lyte.objectUtils(e.error,"delete",r):delete e.error[r]);else if(r)"undefined"!=typeof LyteComponent?Lyte.objectUtils(e.error,"delete",r):delete e.error[r];else if("undefined"!=typeof LyteComponent)for(var o in e.error)Lyte.objectUtils(e.error,"delete",o);else e.error={};0==Object.keys(e.error).length&&(e.isError=!1)},cacheQuery:function(e,r,t){void 0==store.model.cachedQueries&&(store.model.cachedQueries={}),void 0==store.model.cachedQueries[e]&&(store.model.cachedQueries[e]=[]),store.model.cachedQueries[e].push({queryParams:r,data:t})},cacheRecordQuery:function(e,r,t,o){void 0==store.model.cachedRecordQueries&&(store.model.cachedRecordQueries={}),void 0==store.model.cachedRecordQueries[e]&&(store.model.cachedRecordQueries[e]={}),void 0==store.model.cachedRecordQueries[e][r]&&(store.model.cachedRecordQueries[e][r]=[]),store.model.cachedRecordQueries[e][r].push({queryParams:t,data:o})}}};store.adapter={$:{getFromAdapter:function(e,r){for(var t=e?e[r]:void 0;void 0==t;)if(e&&e.$super)e=e.$super,t=e?e[r]:void 0;else{if(e=store.adapter.application,!e||!e[r]){switch(r){case"host":t=window.location.origin;break;case"namespace":t="";break;default:t=void 0}break}t=e[r]}return t},getNamespace:function(e){for(var r=e?e.namespace:void 0;void 0==r;)e&&e.$super?(e=e.$super,r=e?e.namespace:void 0):(e=store.adapter.application,r=e&&e.namespace?e.namespace:"");return r},getHost:function(e){for(var r=e?e.host:void 0;void 0==r;)e&&e.$super?(e=e.$super,r=e?e.host:void 0):(e=store.adapter.application,r=e&&e.host?e.host:window.location.origin);return r},buildURL:function(e,r,t,o,a,i,s,n){var d=store.adapter[t],l=this.getHost(d),c="";void 0!=l&&(c+=l,"/"!=l[l.length-1]&&(c+="/"));var u=this.getNamespace(d);if(c+=""!=u&&"/"!=u[u.length-1]?u+"/":u,c+=t,o&&(c+="/"+o),"action"==e){c+="/"+this.getActionNamespace(d);var f=store.modelFor(t).actions,y=f[s].endPoint?f[s].endPoint:s;c+="/"+y}i||(i={});var p,h=this.getCallBackScope(t,"headersForRequest"),m={method:r?r:""};if(h&&(p=this.constructArgs(e,i,n),m.headers=this.callBack(h,p)),h=this.getCallBackScope(t,"buildURL"),h&&(p=this.constructArgs(t,e,i,a,c,s,n),c=this.callBack(h,p)),h=this.getCallBackScope(t,"methodForRequest"),h&&(p=this.constructArgs(r,e,i,n),m.method=this.callBack(h,p)),!m.data&&Object.keys(i).length){c+="?";var v=0;for(var o in i)0!=v&&(c+="&"),c+=o+"="+i[o],v++}return d&&1==d.withCredentials&&(m.withCredentials=!0),m.url=c,m},getCallBackScope:function(e,r){for(var t,o=store.adapter[e],a=store.adapter.application;void 0==t;){if(o&&o[r]&&"function"==typeof o[r])return{scope:o,func:o[r]};if(!o||!o.$super)return a&&a[r]&&"function"==typeof a[r]?{scope:a,func:a[r]}:void 0;o=o.$super}},callBack:function(e,r){return callbackValue=e.func.apply(e.scope,r)},constructArgs:function(){for(var e=arguments,r=[],t=0;t<e.length;t++)r.push(e[t]);return r},get:function(e,r,t,o,a,i){if(store.modelFor(r)){if("findAll"==e&&o&&store.model.cachedQueries&&store.model.cachedQueries[r]){for(var s,n=store.model.cachedQueries[r],d=0;d<n.length;d++){var l=n[d].queryParams;if(this.compareObjects(l,o)){s=[n[d].data,"cache"];break}}if(s)return new Promise(function(e){e(s)})}else if("findRecord"==e&&o&&store.model.cachedRecordQueries&&store.model.cachedRecordQueries[r]&&store.model.cachedRecordQueries[r][t]){for(var s,n=store.model.cachedRecordQueries[r][t],d=0;d<n.length;d++){var l=n[d].queryParams;if(this.compareObjects(l,o)){s=[n[d].data,"cache"];break}}if(s)return new Promise(function(e){e(s)})}else{var c=this.getCallBackScope(r,"findRecord"==e?"reloadRecord":"reloadAll");if(c){var u;if("findRecord"==e?u=store.peekRecord(r,t):"findAll"==e&&(u=store.peekAll(r)),!this.callBack(c,[u,o])){var f={};return f[r]=u,new Promise(function(e){e([f,"cache"],"success",void 0,!0)})}}}var y=this.buildURL(e,"GET",r,t,void 0,o,void 0,i),p=this;return new Promise(function(t,o){var a,i=p.getFromAdapter(store.adapter[r],"processRequest"),s=!0;if(i){s=!1;var n=p.callGeneric(e,r);n instanceof Promise?n.then(function(o){o=JSON.parse(""==o?"{}":o),a=p.getResponse(o,r,e,l,y),t([a])},function(e){o(e)}):s=!0}if(s){var d=new XMLHttpRequest;d.open("GET",y.url,!0);for(var l in y.headers)d.setRequestHeader(l,y.headers[l]);d.withCredentials=y.withCredentials?!0:!1,d.send(y.data),d.onreadystatechange=function(){if(4==d.readyState)if("2"==d.status.toString()[0]||"3"==d.status.toString()[0]){var i=d.responseText;if(i=JSON.parse(""==i?"{}":i),store.adapter&&store.adapter[r]){var s,n=p.getCallBackScope(r,"parseResponse");n&&(s=p.constructArgs(e,r,d,i),i=p.callBack(n,s))}a=p.getResponse(i,r,e,l,y,d),t([a,d.statusText,d])}else{var s,n=p.getCallBackScope(r,"parseResponse");n&&(s=p.constructArgs(e,r,d),i=p.callBack(n,s)),o(d)}}}})}return Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:r})},getResponse:function(e,r,t,o,a,i){e=store.serializer.$.normalizeResponse(r,t,e,o,i?i.status:i,a.headers);var s,n=store.serializer.$.getCallBackScope(r,"extractMeta"),d=e;if("object"!=typeof d&&(d=JSON.parse(d)),n&&(s=this.constructArgs(d,r,t),d.meta=this.callBack(n,s)),d){if(n=store.serializer.$.getCallBackScope(r,"deserializeKey")){var l=Object.keys(d),c=0;2==l.length&&"meta"==l[0]&&(c=1),s=this.constructArgs(r,t);var u=this.callBack(n,s),f=d[l[c]];delete d[l[c]],d[u]=f}store.serializer.$.normalize(r,t,d,o,i?i.status:i,a.headers)}return d},put:function(e,r,t,o,a){var i=o?"updateRecord":"update",s=this.buildURL(i,"PATCH",e,o?r[store.modelFor(e)._primaryKey]:void 0,r,void 0,void 0,a),n=store.$.toJSON(e,r);return store.$.removeNotDefinedKeys(store.modelFor(e),n),this.sendingData(e,n,s,i,a),this.handleRequest(s,e,t,i)},del:function(e,r,t,o,a){var i=store.modelFor(e)._primaryKey,s=o||"deleteRecord",n=this.buildURL(s,"DELETE",e,t?r[i]:void 0,r,void 0,void 0,a),d={};return t||(d=r.map(function(e){return e[i]})),this.sendingData(e,t?r?r[i]:void 0:d,n,s,a),this.handleRequest(n,e,r,s)},create:function(e,r,t,o){var a=store.$.toJSON(e,r);store.$.removeNotDefinedKeys(store.modelFor(e),a);var i=t?"createRecord":"create",s=this.buildURL(i,"POST",e,void 0,r,void 0,void 0,o);return this.sendingData(e,a,s,i,o),this.handleRequest(s,e,r,i)},sendingData:function(e,r,t,o,a){var i=store.serializer.$.getCallBackScope(e,"serializeKey"),s=e,n={};if(i){var d=this.constructArgs(e,o,a);s=this.callBack(i,d)}s?(Array.isArray(r)||"object"==typeof r||Lyte.isRecord(r))&&(n[s]=r):n=r;var i=store.serializer.$.getCallBackScope(e,"serialize");if(i){var d=this.constructArgs(o,n,r,a);n=this.callBack(i,d)}"deleteRecord"!==o&&"destroyRecord"!==o?t.data=n:i&&n&&void 0!==n&&null!==n&&""!==n&&(t.data=n)},handleAction:function(e,r,t,o){var a;t&&Lyte.isRecord(t)&&(a=t.$.get(r._primaryKey));var i="action",s=this.buildURL(i,"POST",r._name,a,t,void 0,e,o),n=store.serializer.$.getCallBackScope(r._name,"serialize");if(n){var d=this.constructArgs(e,void 0,t,o);s.data=this.callBack(n,d)}return this.handleRequest(s,r._name,void 0,i)},handleRequest:function(e,r,t,o){!e.data||"object"!=typeof e.data&&!Lyte.isRecord(e.data)&&!Array.isArray(e.data)||e.data instanceof FormData||(e.data=JSON.stringify(e.data));var a=this;return new Promise(function(i,s){var n=a.getFromAdapter(store.adapter[r],"processRequest"),d=!0;if(n){d=!1;var l,c=a.callGeneric(o,r,e.data,t);c instanceof Promise?c.then(function(s){s=JSON.parse(""==s?"{}":s),l=a.genericResponse(s,r,o,t,e),i(l)},function(e){s(e)}):d=!0}if(d){var u=new XMLHttpRequest;u.open(e.method,e.url,!0);for(var f in e.headers)u.setRequestHeader(f,e.headers[f]);u.withCredentials=e.withCredentials?!0:!1,u.send(e.data),u.onreadystatechange=function(){if(4==u.readyState)if("2"==u.status.toString()[0]||"3"==u.status.toString()[0]){var n,d=u.responseText;if(d=JSON.parse(""==d?"{}":d),store.adapter&&store.adapter[r]){var l,c=a.getCallBackScope(r,"parseResponse");c&&(l=a.constructArgs(o,r,u,d),d=a.callBack(c,l))}n=a.genericResponse(d,r,o,t,e,u),i(n)}else{var l,c=a.getCallBackScope(r,"parseResponse");c&&(l=a.constructArgs(o,r,u),d=a.callBack(c,l)),s(u)}}}})},callGeneric:function(e,r,t,o,a){var i,s=this.getCallBackScope(r,"processRequest");if(s){var n=this.constructArgs(e,r,t,o,a);i=this.callBack(s,n)}return i},genericResponse:function(e,r,t,o,a,i){var s,n,d=e;if(s=store.serializer.$.getCallBackScope(r,"extractMeta"),s&&(n=this.constructArgs(d,r,t),d.meta=this.callBack(s,n)),d){var s=store.serializer.$.getCallBackScope(r,"deserializeKey");if(s){var l=Object.keys(d),c=0;2==l.length&&"meta"==l[0]&&(c=1);var n=this.constructArgs(r,t),u=this.callBack(s,n),f=d[l[c]];delete d[l[c]],d[u]=f}d=store.serializer.$.buildJSON(r,t,d,Lyte.isRecord(o)?o[store.modelFor(r)._primaryKey]:void 0,i?i.status:i,a.headers)}return"action"!=t&&this.handleResponse(a,o,d[r],i?i.statusText:i,i,store.modelFor(r)),d},checkResponse:function(e,r,t,o){if(e.$.isNew&&(e.hasOwnProperty(o)&&t.hasOwnProperty(o)&&("undefined"!=typeof LyteComponent?LyteComponent.set(e,o,t[o],!0):e[o]=t[o]),store.$.validateAndMerge(r,t),e.$.isNew=!1),e.$.isModified&&(e.$.isModified=!1,e.$._attributes={},!e.$.isDeleted&&t&&store.$.validateAndMerge(r,t)),r.dirty.length&&store.$.deleteFromArray(r.dirty,e[o]),e.$.isDeleted){e.$.isDeleted=!1;var a=r._deleted,i=store.$.getIndex(a,o,e[o]);r._deleted.splice(i,1)}for(var s=e.$.isDirty(),n=0;n<s.length;n++){var d=e[s[n]];if(Array.isArray(d))for(var l=0;l<d.length;l++)d[l].$.isModified=!1;else Lyte.isRecord(d)&&(d.$.isModified=!1)}store.$.clearRecordError(e.$)},handleResponse:function(e,r,t,o,a,i){var s=i._primaryKey;if(Array.isArray(r))for(var n=0;n<r.length;n++)this.checkResponse(r[n],i,Array.isArray(t)?t[n]:t,s);else this.checkResponse(r,i,t,s)},compareObjects:function(e,r){if(!(e instanceof Object&&r instanceof Object))return!1;if(Object.keys(e).length!=Object.keys(r).length)return!1;for(var t in e){var o=e[t],a=r[t];if(void 0==a||o!=a)return!1}return!0},getActionNamespace:function(e){for(var r=e?e.actionNamespace:void 0;void 0==r;)e&&e.$super?(e=e.$super,r=e?e.actionNamespace:void 0):(e=store.adapter.application,r=e&&e.actionNamespace?e.actionNamespace:"action");return r}}},Object.defineProperty(store.adapter,"extends",{enumerable:!1,value:function(e,r,t){if(e){if(store.adapter.hasOwnProperty(e))throw new Error("Adapter with name - "+e+" -  already exists");return store.adapter[e]=new Adapter(r,t,e),store.adapter[e]}}}),store.serializer={$:{getCallBackScope:function(e,r){for(var t,o=store.serializer[e],a=store.serializer.application;void 0==t;){if(o&&o[r]&&"function"==typeof o[r])return{scope:o,func:o[r]};if(!o||!o.$super)return a&&a[r]&&"function"==typeof a[r]?{scope:a,func:a[r]}:void 0;o=o.$super}},buildJSON:function(e,r,t,o,a,i){var s=this.getCallBackScope(e,"normalizeResponse"),n=t;if(s){var d=store.adapter.$.constructArgs(e,r,n,o,a,i);n=store.adapter.$.callBack(s,d)}var l=!1;if((/^(findRecord|findAll)$/.test(r)||n[e])&&(n=n[e],l=!0),s=this.getCallBackScope(e,"normalize"))if(Array.isArray(n))for(var c=0;c<n.length;c++){var d=store.adapter.$.constructArgs(e,r,n[c]);n[c]=store.adapter.$.callBack(s,d)}else{var d=store.adapter.$.constructArgs(e,r,n);n=store.adapter.$.callBack(s,d)}return l?(t={},t[e]=n,t):n},normalizeResponse:function(e,r,t,o,a,i){var s=this.getCallBackScope(e,"normalizeResponse"),n=t;if(s){var d=store.adapter.$.constructArgs(e,r,n,o,a,i);n=store.adapter.$.callBack(s,d)}return n},normalize:function(e,r,t){var o=t,a=!1;(/^(findRecord|findAll)$/.test(r)||o[e])&&(o=o[e],a=!0);var i=this.getCallBackScope(e,"normalize");if(i)if(Array.isArray(o))for(var s=0;s<o.length;s++){var n=store.adapter.$.constructArgs(e,r,o[s]);o[s]=store.adapter.$.callBack(i,n)}else{var n=store.adapter.$.constructArgs(e,r,o);o=store.adapter.$.callBack(i,n)}a&&(t={},t[e]=o)}}},Object.defineProperty(store.serializer,"extends",{enumerable:!1,value:function(e,r,t){if(store.serializer.hasOwnProperty(e))throw new Error("Serializer with name - "+e+" -  already exists");return store.serializer[e]=new Serializer(r,t,e),store.serializer[e]}}),Object.defineProperties(store,{pushPayload:{enumerable:!1,value:function(e,r){var t=store.modelFor(e),r=store.$.insertIntoStore(t,r);return delete t.rel,r}},registerModel:{enumerable:!1,value:function(e,r,t){if(store.model.hasOwnProperty(e))throw new Error("Model with name - "+e+" - already exists");var o,a;if(t&&"object"==typeof t&&(o=t.extends?t.extends:void 0,a=t.actions?t.actions:void 0),o){var i=Object.assign({},store.model[o].fieldList);for(var s in i)"relation"==i[s].type&&delete i[s];r=Object.assign(r,i)}if(store.model[e]=new Model(e,r),o&&(store.model[e].extend=o,store.model[o].extendedBy||(store.model[o].extendedBy={}),store.model[o].extendedBy[e]=!0,!store.adapter[e]&&store.adapter[o]&&(store.adapter[e]=store.adapter[o]),!store.serializer[e]&&store.serializer[o]&&(store.serializer[e]=store.serializer[o]),store.model[o].actions)){void 0==a&&(a={});for(var s in store.model[o].actions)a.hasOwnProperty(s)||(a[s]=store.model[o].actions[s])}return a&&(store.model[e].actions=a),store.model[e]}},modelFor:{enumerable:!1,value:function(e){return store.model[e]}},createRecord:{enumerable:!1,value:function(e,r,t){return this.$.newRecord(e,r,t)}},deleteRecord:{enumerable:!1,value:function(e,r){this.$.removeFromStore(store.modelFor(e),r)}},findAll:{enumerable:!1,value:function(e,r,t,o,a){return store.adapter.$.get("findAll",e,void 0,r,t,a).then(function(){var a=arguments[0][0],i="cache"==arguments[0][1]?!0:!1;if(o===!1)return t&&Object.keys(r).length>0&&store.$.cacheQuery(e,r,a),a;if(a&&!a.save){if(!i){var s=(Object.assign({},a),store.$.toInsertData(e,a));a[e]=s,a.meta&&s&&Object.defineProperty(a[e],"$",{enumerable:!1,value:{meta:a.meta}}),t&&Object.keys(r).length>0&&store.$.cacheQuery(e,r,a)}return a[e]}return arguments},function(e){return Promise.reject(e)})}},findRecord:{enumerable:!1,value:function(e,r,t,o,a,i){return void 0==r?Promise.reject({code:"ERR20",message:Lyte.errorCodes.ERR20}):store.adapter.$.get("findRecord",e,r,t,o,i).then(function(){var i=arguments[0][0],s="cache"==arguments[0][1]?!0:!1;if(a===!1)return"cache"!=arguments[0][1]&&o&&Object.keys(t).length>0&&store.$.cacheRecordQuery(e,r,t,i),i;if(i){if(!s){{Object.assign({},i)}if(!Lyte.isRecord(i)){var n=store.$.toInsertData(e,i);i[e]=n,i.meta&&(n.$.meta=i.meta)}"cache"!=arguments[0][1]&&o&&Object.keys(t).length>0&&store.$.cacheRecordQuery(e,r,t,i)}return i[e]}return arguments},function(e){return Promise.reject(e)})}},peekRecord:{enumerable:!1,value:function(e,r){var t=this.modelFor(e);if(!t)return void console.error("No model found for ",e);var o=t.data,a=this.model[e]._primaryKey,i=o.filter(function(e){return e[a]==r?e:void 0});return i[0]?i[0]:void 0}},peekAll:{enumerable:!1,value:function(e){var r,t=this.modelFor(e);return t?r=t.data:void console.error("No model found for ",e)}},deleteMany:{enumerable:!1,value:function(e,r){this.$.removeFromStore(store.modelFor(e),r)}},unloadRecord:{enumerable:!1,value:function(e,r){var t=store.peekRecord(e,r),o=store.modelFor(e);t&&this.$.removeFromStore(o,t[o._primaryKey],!0);for(var a=0;a<o._deleted.length;a++)if(o._deleted[a].$.get(o._primaryKey)==r){o._deleted.splice(a,1);break}this.model.cachedRecordQueries&&this.model.cachedRecordQueries[e]&&this.model.cachedRecordQueries[e][r]&&(this.model.cachedRecordQueries[e][r]=[])}},unloadAll:{enumerable:!1,value:function(e){var r=[],t=store.peekAll(e),o=this.modelFor(e);if(t)for(var a=0;a<t.length;a++)r.push(t[a][o._primaryKey]);this.$.removeFromStore(o,r,!0),this.model[e].dirty=[],this.model[e]._deleted=[],this.model.cachedQueries&&this.model.cachedQueries[e]&&(this.model.cachedQueries[e]=[])}},triggerAction:{enumerable:!1,value:function(e,r,t){var o=store.modelFor(e),a=o.actions,i=a?o.actions[r]:void 0;return i?store.adapter.$.handleAction(r,o,store.peekAll(e),t).then(function(e){return e},function(e){return Promise.reject(e)}):Promise.reject({code:"ERR18",message:Lyte.errorCodes.ERR18})}},rollBack:{enumerable:!1,value:function(e){var r=this.modelFor(e);if(void 0!=r){for(var t=r._primaryKey,o=this;r.dirty.length;){var a=o.peekRecord(e,r.dirty[0]);a&&a.$.isModified?a.$.rollBackAttributes(a.$.getDirtyAttributes()):a&&a.$.isNew&&o.$.rollBackNew(r,a,t)}for(;r._deleted.length>0;)this.$.rollBackDelete(r,0)}}},create:{enumerable:!1,value:function(e,r,t){var o=store.modelFor(e);if(void 0==o)return Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});if(r){var a=this.$.newRecord(e,r);if(a.$.isError)return Promise.reject(a)}for(var i=o.dirty,s=[],n=0;n<i.length;n++){var d=store.peekRecord(e,i[n]);d&&d.$.isNew&&s.push(d)}return s.length?store.adapter.$.create(e,s,!1,t):Promise.resolve()}},update:{enumerable:!1,value:function(e,r){var t=this.modelFor(e);if(void 0==t)return Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});for(var o=[],a=[],i=t._primaryKey,s=0;s<t.dirty.length;s++){var n=store.peekRecord(e,t.dirty[s]);if(n&&n.$.isModified&&!n.$.isNew){var d=n.$._attributes,l={};for(var c in d)l[c]=n.$.get(c);l[i]=n.$.get(i),o.push(l),a.push(n)}}return o.length?store.adapter.$.put(e,o,a,!1,r):Promise.resolve()}},"delete":{enumerable:!1,value:function(e,r,t){var o=store.modelFor(e);if(void 0==o)return Promise.reject({code:"ERR19",message:Lyte.errorCodes.ERR19,data:e});r&&this.deleteRecord(e,r);for(var a=[],i=0;i<o._deleted.length;i++)o._deleted[i].$.isNew?store.adapter.$.handleResponse(void 0,o._deleted[i],o._deleted[i],void 0,void 0,o):a.push(o._deleted[i]);if(a.length){{o._primaryKey}return store.adapter.$.del(e,a,void 0,"delete",t).then(function(e){return e},function(e){return Promise.reject(e)})}return Promise.resolve()}},registerAdapter:{enumerable:!1,value:store.adapter.extends},registerSerializer:{enumerable:!1,value:store.serializer.extends},clearCachedQuery:{enumerable:!1,value:function(e,r,t){var o=[];r&&"object"==typeof r?(t=r,this.model.cachedQueries&&this.model.cachedQueries[e]&&(o=this.model.cachedQueries[e])):this.model.cachedRecordQueries&&this.model.cachedRecordQueries[e]&&this.model.cachedRecordQueries[e][r]&&(o=this.model.cachedRecordQueries[e][r]);for(var a=0;a<o.length;a++)if(this.adapter.$.compareObjects(o[a].queryParams,t)){o.splice(a,1);break}}},setErrorMessages:{enumerable:!1,value:function(e){Object.assign(Lyte.errorCodes,e)}},addEventListener:{enumerable:!1,value:function(e,r){return store.$.eventListeners.add(store,e,r)}},removeEventListener:{enumerable:!1,value:function(e){store.$.eventListeners.remove(store,e)}},emit:{enumerable:!1,value:function(e,r){store.$.eventListeners.emit(store,e,r)}}});var error1=function(e,r){Object.defineProperties(this,{$:{enumerable:!1,value:{isError:!0,error:{}}}}),e&&store.$.setError(this,e,r)};